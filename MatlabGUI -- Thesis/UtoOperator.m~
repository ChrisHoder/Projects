%dList holds a list of all of the displacement operator matrixes for each
%kick value

%dMatrix is the displacement matrix which should already have been
%generated earlier

%mMax is the simulation extent for the double sum. while nMax is the number
%of energy states to simulate with.

function out = UtoOperator(y_init,values,nMax,mMax,phiNot,theta,dList),

    for l=0:nMax,
       lValueUp = 0;
       lValueDown = 0;
       for m = 0:nMax, 
            
            for n = -mMax:1:mMax,
                %we have to index off of 1 -> 2*nMax+1
                dMatrix = dList(n+nMax+1);
                temp2 = ((1i)^n)*(e^(1i*n*phiNot))*besselj(n,theta/2)*dMatrix(l,m);
                %even values
                if( mod(n,2) == 0),
                   temp = temp2*y_init(m+1);
                   temp3 = temp2*y_init(nMax+2+m);
                   lValueUp = lValueUp + temp;
                   lValueDown = lValueDown + temp3;
                else
                    %odd values
                    temp = temp2*y_init(nMax+2+m);
                    lValueUp = lValueUp + temp;

                end

            end
       end
        
        
    end


